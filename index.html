<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç–∞</title>
  <style>
    :root{
      --bg:#0b0c10;
      --card:#111318;
      --text:#e9eef5;
      --muted:#9aa7b2;
      --primary:#6aa7ff;
      --accent:#c29bff;
      --success:#28c281;
      --warning:#ffb347;
      --danger:#ff6b6b;
      --border:#23262d;
      --radius:16px;
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --grad:linear-gradient(135deg,var(--primary),var(--accent));
    }
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    html,body{
      margin:0;
      padding:0;
      background:var(--bg);
      color:var(--text);
      font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;
      min-height:100vh;
    }
    .container{
      max-width:700px;
      margin:0 auto;
      padding:40px 20px;
    }
    .header{
      text-align:center;
      margin-bottom:40px;
    }
    .header h1{
      font-weight:800;
      font-size:clamp(28px,6vw,36px);
      line-height:1.2;
      margin:0 0 8px;
    }
    .header p{
      color:var(--muted);
      margin:0;
    }
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:32px;
    }
    .form-group{
      margin-bottom:28px;
    }
    .form-label{
      display:block;
      font-weight:700;
      margin-bottom:10px;
      font-size:15px;
    }
    .form-input{
      width:100%;
      padding:14px 16px;
      background:rgba(255,255,255,.03);
      border:1px solid var(--border);
      border-radius:12px;
      color:var(--text);
      font-size:16px;
      font-family:inherit;
      transition:border-color .15s;
    }
    .form-input:focus{
      outline:none;
      border-color:var(--primary);
    }
    .form-input::placeholder{
      color:var(--muted);
    }
    .form-textarea{
      width:100%;
      padding:14px 16px;
      background:rgba(255,255,255,.03);
      border:1px solid var(--border);
      border-radius:12px;
      color:var(--text);
      font-size:16px;
      font-family:inherit;
      transition:border-color .15s;
      resize:vertical;
      min-height:80px;
    }
    .form-textarea:focus{
      outline:none;
      border-color:var(--primary);
    }
    .form-textarea::placeholder{
      color:var(--muted);
    }
    .content-type-buttons{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:12px;
    }
    .type-btn{
      padding:16px 12px;
      background:rgba(255,255,255,.03);
      border:2px solid var(--border);
      border-radius:12px;
      color:var(--text);
      font-weight:600;
      font-size:15px;
      cursor:pointer;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:8px;
      min-height:90px;
      touch-action:manipulation;
      user-select:none;
    }
    .type-btn:active{
      opacity:.7;
    }
    .type-btn.active{
      background:var(--grad);
      border-color:transparent;
      color:#0b1020;
    }
    .type-btn .icon{
      font-size:24px;
    }
    .type-btn .label{
      font-size:14px;
    }
    .platform-buttons{
      display:grid;
      grid-template-columns:repeat(2,1fr);
      gap:12px;
    }
    .platform-btn{
      padding:14px 16px;
      background:rgba(255,255,255,.03);
      border:2px solid var(--border);
      border-radius:12px;
      color:var(--text);
      font-weight:600;
      font-size:14px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:flex-start;
      gap:10px;
      min-height:50px;
      touch-action:manipulation;
      user-select:none;
    }
    .platform-btn:active{
      opacity:.7;
    }
    .platform-btn.active{
      background:var(--grad);
      border-color:transparent;
      color:#0b1020;
    }
    .platform-btn .icon{
      font-size:18px;
      min-width:20px;
    }
    .submit-btn{
      width:100%;
      padding:16px;
      background:var(--grad);
      border:none;
      border-radius:12px;
      color:#0b1020;
      font-weight:800;
      font-size:16px;
      cursor:pointer;
      margin-top:12px;
      touch-action:manipulation;
      user-select:none;
    }
    .submit-btn:active{
      opacity:.8;
    }
    .submit-btn:disabled{
      opacity:.5;
      cursor:not-allowed;
    }
    .bulk-import-btn{
      width:100%;
      padding:14px;
      background:rgba(255,255,255,.05);
      border:2px solid var(--border);
      border-radius:12px;
      color:var(--text);
      font-weight:700;
      font-size:15px;
      cursor:pointer;
      margin-top:12px;
      touch-action:manipulation;
      user-select:none;
    }
    .bulk-import-btn:active{
      opacity:.7;
    }
    .modal{
      display:none;
      position:fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background:rgba(0,0,0,.7);
      z-index:1000;
      align-items:center;
      justify-content:center;
      padding:20px;
    }
    .modal.show{
      display:flex;
    }
    .modal-content{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:32px;
      max-width:500px;
      width:100%;
      box-shadow:0 20px 60px rgba(0,0,0,.5);
    }
    .modal-header{
      font-size:22px;
      font-weight:800;
      margin:0 0 20px;
    }
    .modal-body{
      margin-bottom:24px;
    }
    .confirmation-item{
      padding:12px;
      background:rgba(255,255,255,.03);
      border-radius:8px;
      margin-bottom:8px;
    }
    .confirmation-label{
      color:var(--muted);
      font-size:13px;
      font-weight:600;
      text-transform:uppercase;
      letter-spacing:.5px;
      margin-bottom:4px;
    }
    .confirmation-value{
      color:var(--text);
      font-weight:500;
      word-break:break-word;
    }
    .modal-actions{
      display:flex;
      gap:12px;
    }
    .modal-btn{
      flex:1;
      padding:14px;
      border:none;
      border-radius:10px;
      font-weight:700;
      font-size:15px;
      cursor:pointer;
      touch-action:manipulation;
    }
    .modal-btn.confirm{
      background:var(--grad);
      color:#0b1020;
    }
    .modal-btn.cancel{
      background:rgba(255,255,255,.05);
      color:var(--text);
      border:1px solid var(--border);
    }
    .modal-btn:active{
      opacity:.7;
    }
    .success-message{
      background:rgba(40,194,129,.1);
      border:1px solid rgba(40,194,129,.3);
      color:var(--success);
      padding:16px;
      border-radius:12px;
      margin-top:20px;
      text-align:center;
      font-weight:600;
      display:none;
    }
    .success-message.show{
      display:block;
    }
    .error-message{
      background:rgba(255,107,107,.1);
      border:1px solid rgba(255,107,107,.3);
      color:var(--danger);
      padding:16px;
      border-radius:12px;
      margin-top:20px;
      text-align:center;
      font-weight:600;
      display:none;
    }
    .error-message.show{
      display:block;
    }
    .checkbox-wrapper{
      display:flex;
      align-items:center;
      gap:8px;
      margin-top:12px;
    }
    .checkbox{
      width:18px;
      height:18px;
      cursor:pointer;
    }
    .checkbox-label{
      font-size:14px;
      color:var(--muted);
      cursor:pointer;
      user-select:none;
    }
    #deadlineGroup{
      display:none;
    }
    #deadlineGroup.show{
      display:block;
    }
    #commentGroup{
      display:none;
    }
    #commentGroup.show{
      display:block;
    }
    .bulk-modal{
      display:none;
      position:fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background:rgba(0,0,0,.7);
      z-index:1001;
      align-items:center;
      justify-content:center;
      padding:20px;
      overflow-y:auto;
    }
    .bulk-modal.show{
      display:flex;
    }
    .bulk-modal-content{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:32px;
      max-width:600px;
      width:100%;
      box-shadow:0 20px 60px rgba(0,0,0,.5);
      max-height:90vh;
      overflow-y:auto;
    }
    .bulk-textarea{
      width:100%;
      min-height:200px;
      padding:14px 16px;
      background:rgba(255,255,255,.03);
      border:1px solid var(--border);
      border-radius:12px;
      color:var(--text);
      font-size:14px;
      font-family:monospace;
      resize:vertical;
    }
    .bulk-textarea:focus{
      outline:none;
      border-color:var(--primary);
    }
    .bulk-textarea::placeholder{
      color:var(--muted);
    }
    .time-selector{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:12px;
      margin-top:10px;
    }
    .time-btn{
      padding:12px;
      background:rgba(255,255,255,.03);
      border:2px solid var(--border);
      border-radius:10px;
      color:var(--text);
      font-weight:600;
      font-size:14px;
      cursor:pointer;
      touch-action:manipulation;
      user-select:none;
    }
    .time-btn:active{
      opacity:.7;
    }
    .time-btn.active{
      background:var(--grad);
      border-color:transparent;
      color:#0b1020;
    }
    .bulk-group-preview{
      background:rgba(255,255,255,.03);
      border:1px solid var(--border);
      border-radius:12px;
      padding:16px;
      margin-bottom:12px;
    }
    .bulk-group-header{
      font-weight:700;
      font-size:15px;
      margin-bottom:8px;
      color:var(--primary);
    }
    .bulk-group-info{
      font-size:13px;
      color:var(--muted);
      margin-bottom:4px;
    }
    .bulk-total{
      font-size:16px;
      font-weight:700;
      color:var(--success);
      text-align:center;
      padding:16px;
      background:rgba(40,194,129,.1);
      border-radius:12px;
      margin-top:16px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üì± –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</h1>
      <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—É–±–ª–∏–∫–∞—Ü–∏—è–º–∏ –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö</p>
    </div>

    <div class="card">
      <form id="taskForm">
        <!-- –°—Å—ã–ª–∫–∞ –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª -->
        <div class="form-group">
          <label class="form-label">üîó –°—Å—ã–ª–∫–∞ –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª</label>
          <input 
            type="url" 
            class="form-input" 
            id="materialLink" 
            placeholder="https://example.com/material"
            required
          />
        </div>

        <!-- –í—ã–±–æ—Ä —Ç–∏–ø–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
        <div class="form-group">
          <label class="form-label">üìã –¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞</label>
          <div class="content-type-buttons">
            <button type="button" class="type-btn" data-type="–ü–æ—Å—Ç">
              <span class="icon">üìù</span>
              <span class="label">–ü–æ—Å—Ç</span>
            </button>
            <button type="button" class="type-btn" data-type="–†–æ–ª–∏–∫">
              <span class="icon">üé¨</span>
              <span class="label">–†–æ–ª–∏–∫</span>
            </button>
            <button type="button" class="type-btn" data-type="–ö–∞—Ä—É—Å–µ–ª—å">
              <span class="icon">üé†</span>
              <span class="label">–ö–∞—Ä—É—Å–µ–ª—å</span>
            </button>
          </div>
        </div>

        <!-- –í—ã–±–æ—Ä –ø–ª–∞—Ç—Ñ–æ—Ä–º (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –º–µ–Ω—è–µ—Ç—Å—è) -->
        <div class="form-group" id="platformsGroup" style="display:none;">
          <label class="form-label">üåê –ì–¥–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</label>
          <div class="platform-buttons" id="platformButtons">
            <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JS -->
          </div>
        </div>

        <!-- –ß–µ–∫–±–æ–∫—Å –¥–ª—è –¥–µ–¥–ª–∞–π–Ω–∞ -->
        <div class="form-group">
          <div class="checkbox-wrapper">
            <input type="checkbox" id="hasDeadline" class="checkbox" />
            <label for="hasDeadline" class="checkbox-label">–£–∫–∞–∑–∞—Ç—å –¥–µ–¥–ª–∞–π–Ω</label>
          </div>
        </div>

        <!-- –î–µ–¥–ª–∞–π–Ω (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ —á–µ–∫–±–æ–∫—Å–∞) -->
        <div class="form-group" id="deadlineGroup">
          <label class="form-label">üìÖ –î–µ–¥–ª–∞–π–Ω</label>
          <input 
            type="datetime-local" 
            class="form-input" 
            id="deadline"
          />
        </div>

        <!-- –ß–µ–∫–±–æ–∫—Å –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
        <div class="form-group">
          <div class="checkbox-wrapper">
            <input type="checkbox" id="hasComment" class="checkbox" />
            <label for="hasComment" class="checkbox-label">–û—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
          </div>
        </div>

        <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ —á–µ–∫–±–æ–∫—Å–∞) -->
        <div class="form-group" id="commentGroup">
          <label class="form-label">üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–¥–∞—á–µ</label>
          <textarea 
            class="form-textarea" 
            id="taskComment"
            placeholder="–î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏..."
            rows="3"
          ></textarea>
        </div>

        <button type="submit" class="submit-btn">
          ‚ú® –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–¥–∞—á–∏
        </button>
        
        <button type="button" class="bulk-import-btn" id="bulkImportBtn">
          ‚ö° –ú–∞—Å—Å–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç
        </button>
      </form>

      <div class="success-message" id="successMessage">
        ‚úÖ –ó–∞–¥–∞—á–∏ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ Google –¢–∞–±–ª–∏—Ü—É!
      </div>

      <div class="error-message" id="errorMessage">
        ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
  <div class="modal" id="confirmModal">
    <div class="modal-content">
      <h2 class="modal-header">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–¥–∞—á</h2>
      <div class="modal-body" id="confirmationBody">
        <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
      </div>
      <div class="modal-actions">
        <button class="modal-btn cancel" id="cancelBtn">–û—Ç–º–µ–Ω–∞</button>
        <button class="modal-btn confirm" id="confirmBtn">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –º–∞—Å—Å–æ–≤–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ -->
  <div class="bulk-modal" id="bulkModal">
    <div class="bulk-modal-content">
      <h2 class="modal-header">‚ö° –ú–∞—Å—Å–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç</h2>
      
      <div class="form-group">
        <label class="form-label">üìù –°–ø–∏—Å–æ–∫ —Å—Å—ã–ª–æ–∫ (–∫–∞–∂–¥–∞—è —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)</label>
        <textarea 
          class="bulk-textarea" 
          id="bulkLinks"
          placeholder="https://example.com/1
https://example.com/2
https://example.com/3
..."
        ></textarea>
      </div>

      <div class="form-group">
        <label class="form-label">üìã –¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞</label>
        <div class="content-type-buttons">
          <button type="button" class="type-btn" data-type="–ü–æ—Å—Ç">
            <span class="icon">üìù</span>
            <span class="label">–ü–æ—Å—Ç</span>
          </button>
          <button type="button" class="type-btn" data-type="–†–æ–ª–∏–∫">
            <span class="icon">üé¨</span>
            <span class="label">–†–æ–ª–∏–∫</span>
          </button>
          <button type="button" class="type-btn" data-type="–ö–∞—Ä—É—Å–µ–ª—å">
            <span class="icon">üé†</span>
            <span class="label">–ö–∞—Ä—É—Å–µ–ª—å</span>
          </button>
        </div>
      </div>

      <div class="form-group" id="bulkPlatformsGroup" style="display:none;">
        <label class="form-label">üåê –ì–¥–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</label>
        <div class="platform-buttons" id="bulkPlatformButtons">
          <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JS -->
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">‚è∞ –í—Ä–µ–º—è –¥–µ–¥–ª–∞–π–Ω–∞</label>
        <div class="time-selector">
          <button type="button" class="time-btn" data-time="12:00">12:00</button>
          <button type="button" class="time-btn" data-time="15:00">15:00</button>
          <button type="button" class="time-btn" data-time="19:00">19:00</button>
        </div>
      </div>

      <div class="modal-actions">
        <button class="modal-btn cancel" id="bulkCancelBtn">–û—Ç–º–µ–Ω–∞</button>
        <button class="modal-btn confirm" id="bulkPreviewBtn">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</button>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –º–∞—Å—Å–æ–≤–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ -->
  <div class="bulk-modal" id="bulkPreviewModal">
    <div class="bulk-modal-content">
      <h2 class="modal-header">üì¶ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–º–ø–æ—Ä—Ç–∞</h2>
      <div id="bulkPreviewContent">
        <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
      </div>
      <div class="modal-actions">
        <button class="modal-btn cancel" id="bulkPreviewCancelBtn">–ù–∞–∑–∞–¥</button>
        <button class="modal-btn confirm" id="bulkConfirmBtn">–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
      </div>
    </div>
  </div>

  <script>
    // URL Google Apps Script
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxr749U3VyolTQVFoK57dsXoTcsc00PUal1s238lM905fGeV8KepWvI1QjlwxMreWdVjw/exec';
    
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    const PLATFORMS = {
      '–ü–æ—Å—Ç': [
        { id: 'vk-personal', name: '–í–ö - –ª–∏—á–Ω—ã–π –∞–∫–∫', icon: 'üë§' },
        { id: 'vk-group', name: '–í–ö - –ø–æ—Å—Ç –≥—Ä—É–ø–ø–∞', icon: 'üë•' },
        { id: 'ok-feed', name: '–û–ö - –ø–æ—Å—Ç –≤ –ª–µ–Ω—Ç—É', icon: 'üü†' },
        { id: 'threads', name: 'Threads', icon: 'üßµ' }
      ],
      '–†–æ–ª–∏–∫': [
        { id: 'tiktok', name: 'TikTok', icon: 'üéµ' },
        { id: 'youtube-shorts', name: 'YouTube Shorts', icon: 'üì∫' },
        { id: 'vk-clips', name: 'VK –∫–ª–∏–ø—ã', icon: 'üé¨' },
        { id: 'ok-video', name: '–û–ö –≤–∏–¥–µ–æ', icon: 'üé•' },
        { id: 'dzen-video', name: '–î–∑–µ–Ω –≤–∏–¥–µ–æ', icon: 'üìπ' }
      ],
      '–ö–∞—Ä—É—Å–µ–ª—å': [
        { id: 'tiktok', name: 'TikTok', icon: 'üéµ' },
        { id: 'vk-post', name: '–í–ö –ø–æ—Å—Ç', icon: 'üì∏' },
        { id: 'ok-post', name: '–û–ö –ø–æ—Å—Ç', icon: 'üñºÔ∏è' }
      ]
    };

    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    const form = document.getElementById('taskForm');
    const modal = document.getElementById('confirmModal');
    const confirmBtn = document.getElementById('confirmBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const typeButtons = document.querySelectorAll('.type-btn');
    const platformsGroup = document.getElementById('platformsGroup');
    const platformButtons = document.getElementById('platformButtons');
    const hasDeadlineCheckbox = document.getElementById('hasDeadline');
    const deadlineGroup = document.getElementById('deadlineGroup');
    const hasCommentCheckbox = document.getElementById('hasComment');
    const commentGroup = document.getElementById('commentGroup');
    const successMessage = document.getElementById('successMessage');
    const errorMessage = document.getElementById('errorMessage');
    
    let selectedType = null;
    let selectedPlatforms = new Set();
    let formData = {};

    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞
    let bulkSelectedType = null;
    let bulkSelectedPlatforms = new Set();
    let bulkSelectedTime = null;
    let bulkData = {};

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    window.addEventListener('DOMContentLoaded', () => {
      // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–∞—Ç—ã (—Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –ø–æ –ú–æ—Å–∫–≤–µ)
      const now = new Date();
      // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –≤ –º–æ—Å–∫–æ–≤—Å–∫–æ–µ
      const moscowOffset = 3 * 60; // GMT+3 –≤ –º–∏–Ω—É—Ç–∞—Ö
      const localOffset = now.getTimezoneOffset(); // —Å–º–µ—â–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç UTC
      const totalOffset = moscowOffset + localOffset;
      const moscowTime = new Date(now.getTime() + totalOffset * 60 * 1000);
      
      // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–ª—è datetime-local input
      const year = moscowTime.getFullYear();
      const month = String(moscowTime.getMonth() + 1).padStart(2, '0');
      const day = String(moscowTime.getDate()).padStart(2, '0');
      const hours = String(moscowTime.getHours()).padStart(2, '0');
      const minutes = String(moscowTime.getMinutes()).padStart(2, '0');
      
      document.getElementById('deadline').min = `${year}-${month}-${day}T${hours}:${minutes}`;
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ–∫–±–æ–∫—Å–∞ –¥–µ–¥–ª–∞–π–Ω–∞
    hasDeadlineCheckbox.addEventListener('change', (e) => {
      if (e.target.checked) {
        deadlineGroup.classList.add('show');
      } else {
        deadlineGroup.classList.remove('show');
        document.getElementById('deadline').value = '';
      }
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ–∫–±–æ–∫—Å–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
    hasCommentCheckbox.addEventListener('change', (e) => {
      if (e.target.checked) {
        commentGroup.classList.add('show');
      } else {
        commentGroup.classList.remove('show');
        document.getElementById('taskComment').value = '';
      }
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    typeButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const type = btn.dataset.type;
        
        // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
        typeButtons.forEach(b => b.classList.remove('active'));
        
        // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é
        btn.classList.add('active');
        selectedType = type;
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
        selectedPlatforms.clear();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
        renderPlatforms(type);
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥—Ä—É–ø–ø—É –ø–ª–∞—Ç—Ñ–æ—Ä–º
        platformsGroup.style.display = 'block';
      });
    });

    // –†–µ–Ω–¥–µ—Ä –ø–ª–∞—Ç—Ñ–æ—Ä–º –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞
    function renderPlatforms(type) {
      const platforms = PLATFORMS[type];
      platformButtons.innerHTML = '';
      
      platforms.forEach(platform => {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'platform-btn';
        btn.dataset.platformId = platform.id;
        btn.dataset.platformName = platform.name;
        btn.innerHTML = `
          <span class="icon">${platform.icon}</span>
          <span>${platform.name}</span>
        `;
        
        btn.addEventListener('click', () => {
          if (selectedPlatforms.has(platform.name)) {
            selectedPlatforms.delete(platform.name);
            btn.classList.remove('active');
          } else {
            selectedPlatforms.add(platform.name);
            btn.classList.add('active');
          }
        });
        
        platformButtons.appendChild(btn);
      });
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
    form.addEventListener('submit', (e) => {
      e.preventDefault();
      
      // –°–∫—Ä—ã—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
      successMessage.classList.remove('show');
      errorMessage.classList.remove('show');

      // –í–∞–ª–∏–¥–∞—Ü–∏—è
      if (!selectedType) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞');
        return;
      }

      if (selectedPlatforms.size === 0) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏');
        return;
      }

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–¥–ª–∞–π–Ω–∞
      const hasDeadline = hasDeadlineCheckbox.checked;
      const deadline = hasDeadline ? document.getElementById('deadline').value : null;
      
      if (hasDeadline && !deadline) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –¥–µ–¥–ª–∞–π–Ω –∏–ª–∏ —Å–Ω–∏–º–∏—Ç–µ –≥–∞–ª–æ—á–∫—É');
        return;
      }

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
      const hasComment = hasCommentCheckbox.checked;
      const comment = hasComment ? document.getElementById('taskComment').value.trim() : '';
      
      if (hasComment && !comment) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∏–ª–∏ —Å–Ω–∏–º–∏—Ç–µ –≥–∞–ª–æ—á–∫—É');
        return;
      }

      // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã
      formData = {
        materialLink: document.getElementById('materialLink').value,
        contentType: selectedType,
        platforms: Array.from(selectedPlatforms),
        deadline: deadline,
        hasDeadline: hasDeadline,
        comment: comment,
        hasComment: hasComment
      };

      // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
      const platformNames = formData.platforms.join(', ');
      let deadlineFormatted = '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω';
      
      if (formData.hasDeadline && formData.deadline) {
        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º datetime-local –≤ –º–æ—Å–∫–æ–≤—Å–∫–æ–µ –≤—Ä–µ–º—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        const deadlineDate = new Date(formData.deadline);
        const moscowOffset = 3 * 60;
        const localOffset = deadlineDate.getTimezoneOffset();
        const totalOffset = moscowOffset + localOffset;
        const moscowDeadline = new Date(deadlineDate.getTime() + totalOffset * 60 * 1000);
        
        const day = String(moscowDeadline.getDate()).padStart(2, '0');
        const month = String(moscowDeadline.getMonth() + 1).padStart(2, '0');
        const year = moscowDeadline.getFullYear();
        const hours = String(moscowDeadline.getHours()).padStart(2, '0');
        const minutes = String(moscowDeadline.getMinutes()).padStart(2, '0');
        
        deadlineFormatted = `${hours}:${minutes} ${day}.${month}.${year}`;
      }
      
      let confirmationHTML = `
        <div class="confirmation-item">
          <div class="confirmation-label">–°—Å—ã–ª–∫–∞ –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª</div>
          <div class="confirmation-value">${formData.materialLink}</div>
        </div>
        <div class="confirmation-item">
          <div class="confirmation-label">–¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞</div>
          <div class="confirmation-value">${formData.contentType}</div>
        </div>
        <div class="confirmation-item">
          <div class="confirmation-label">–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã (${formData.platforms.length} –∑–∞–¥–∞—á)</div>
          <div class="confirmation-value">${platformNames}</div>
        </div>
        <div class="confirmation-item">
          <div class="confirmation-label">–î–µ–¥–ª–∞–π–Ω</div>
          <div class="confirmation-value">${deadlineFormatted}</div>
        </div>
      `;

      if (formData.hasComment) {
        confirmationHTML += `
          <div class="confirmation-item">
            <div class="confirmation-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</div>
            <div class="confirmation-value">${formData.comment}</div>
          </div>
        `;
      }

      document.getElementById('confirmationBody').innerHTML = confirmationHTML;
      modal.classList.add('show');
    });

    // –û—Ç–º–µ–Ω–∞
    cancelBtn.addEventListener('click', () => {
      modal.classList.remove('show');
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.classList.remove('show');
      }
    });

    // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Google Sheets
    confirmBtn.addEventListener('click', async () => {
      modal.classList.remove('show');
      
      try {
        // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á
        const tasks = formData.platforms.map(platformName => ({
          materialLink: formData.materialLink,
          contentType: formData.contentType,
          platform: platformName,
          deadline: formData.hasDeadline ? formData.deadline : null,
          comment: formData.hasComment ? formData.comment : ''
        }));

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Google Sheets
        const response = await fetch(SCRIPT_URL, {
          method: 'POST',
          mode: 'no-cors',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ tasks: tasks })
        });

        // –ü–æ–∫–∞–∑–∞—Ç—å —É—Å–ø–µ—à–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        successMessage.textContent = `‚úÖ ${tasks.length} –∑–∞–¥–∞—á${tasks.length > 1 ? '–∏' : '–∞'} —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω${tasks.length > 1 ? '—ã' : '–∞'} –≤ Google –¢–∞–±–ª–∏—Ü—É!`;
        successMessage.classList.add('show');
        
        // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã
        form.reset();
        selectedType = null;
        selectedPlatforms.clear();
        typeButtons.forEach(btn => btn.classList.remove('active'));
        platformsGroup.style.display = 'none';
        deadlineGroup.classList.remove('show');
        hasDeadlineCheckbox.checked = false;
        commentGroup.classList.remove('show');
        hasCommentCheckbox.checked = false;

        // –°–∫—Ä—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
        setTimeout(() => {
          successMessage.classList.remove('show');
        }, 5000);

      } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
        errorMessage.classList.add('show');
        
        setTimeout(() => {
          errorMessage.classList.remove('show');
        }, 5000);
      }
    });

    // ============================================
    // –ú–ê–°–°–û–í–´–ô –ò–ú–ü–û–†–¢
    // ============================================

    const bulkImportBtn = document.getElementById('bulkImportBtn');
    const bulkModal = document.getElementById('bulkModal');
    const bulkPreviewModal = document.getElementById('bulkPreviewModal');
    const bulkCancelBtn = document.getElementById('bulkCancelBtn');
    const bulkPreviewBtn = document.getElementById('bulkPreviewBtn');
    const bulkPreviewCancelBtn = document.getElementById('bulkPreviewCancelBtn');
    const bulkConfirmBtn = document.getElementById('bulkConfirmBtn');
    const bulkPlatformsGroup = document.getElementById('bulkPlatformsGroup');
    const bulkPlatformButtons = document.getElementById('bulkPlatformButtons');

    // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –º–∞—Å—Å–æ–≤–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞
    bulkImportBtn.addEventListener('click', () => {
      bulkModal.classList.add('show');
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –º–∞—Å—Å–æ–≤–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞
    bulkCancelBtn.addEventListener('click', () => {
      bulkModal.classList.remove('show');
    });

    bulkModal.addEventListener('click', (e) => {
      if (e.target === bulkModal) {
        bulkModal.classList.remove('show');
      }
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞
    const bulkTypeButtons = bulkModal.querySelectorAll('.type-btn');
    bulkTypeButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const type = btn.dataset.type;
        
        bulkTypeButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        bulkSelectedType = type;
        
        bulkSelectedPlatforms.clear();
        renderBulkPlatforms(type);
        bulkPlatformsGroup.style.display = 'block';
      });
    });

    // –†–µ–Ω–¥–µ—Ä –ø–ª–∞—Ç—Ñ–æ—Ä–º –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞
    function renderBulkPlatforms(type) {
      const platforms = PLATFORMS[type];
      bulkPlatformButtons.innerHTML = '';
      
      platforms.forEach(platform => {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'platform-btn';
        btn.dataset.platformName = platform.name;
        btn.innerHTML = `
          <span class="icon">${platform.icon}</span>
          <span>${platform.name}</span>
        `;
        
        btn.addEventListener('click', () => {
          if (bulkSelectedPlatforms.has(platform.name)) {
            bulkSelectedPlatforms.delete(platform.name);
            btn.classList.remove('active');
          } else {
            bulkSelectedPlatforms.add(platform.name);
            btn.classList.add('active');
          }
        });
        
        bulkPlatformButtons.appendChild(btn);
      });
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏
    const timeButtons = bulkModal.querySelectorAll('.time-btn');
    timeButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        timeButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        bulkSelectedTime = btn.dataset.time;
      });
    });

    // –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –º–∞—Å—Å–æ–≤–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞
    bulkPreviewBtn.addEventListener('click', () => {
      // –í–∞–ª–∏–¥–∞—Ü–∏—è
      const linksText = document.getElementById('bulkLinks').value.trim();
      
      if (!linksText) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Å–ø–∏—Å–æ–∫ —Å—Å—ã–ª–æ–∫');
        return;
      }

      if (!bulkSelectedType) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞');
        return;
      }

      if (bulkSelectedPlatforms.size === 0) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –ø–ª–∞—Ç—Ñ–æ—Ä–º—É');
        return;
      }

      if (!bulkSelectedTime) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è –¥–µ–¥–ª–∞–π–Ω–∞');
        return;
      }

      // –ü–∞—Ä—Å–∏–º —Å—Å—ã–ª–∫–∏ (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏)
      const links = linksText.split('\n')
        .map(link => link.trim())
        .filter(link => link.length > 0);

      if (links.length === 0) {
        alert('–ù–µ –Ω–∞–π–¥–µ–Ω–æ –≤–∞–ª–∏–¥–Ω—ã—Ö —Å—Å—ã–ª–æ–∫');
        return;
      }

      // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —Å—Å—ã–ª–∫–∏ –ø–æ 3
      const groups = [];
      for (let i = 0; i < links.length; i += 3) {
        groups.push(links.slice(i, i + 3));
      }

      // –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
      const platforms = Array.from(bulkSelectedPlatforms);
      const platformsText = platforms.join(', ');
      
      let previewHTML = '';
      let totalTasks = 0;

      groups.forEach((group, index) => {
        const hoursOffset = (index + 1) * 24;
        const deadline = calculateDeadline(hoursOffset, bulkSelectedTime);
        const tasksCount = group.length * platforms.length;
        totalTasks += tasksCount;

        const linkRange = group.length === 1 
          ? `—Å—Å—ã–ª–∫–∞ ${index * 3 + 1}`
          : `—Å—Å—ã–ª–∫–∏ ${index * 3 + 1}-${index * 3 + group.length}`;

        previewHTML += `
          <div class="bulk-group-preview">
            <div class="bulk-group-header">üì¶ –ì—Ä—É–ø–ø–∞ ${index + 1} (${linkRange})</div>
            <div class="bulk-group-info">‚Üí ${platformsText}</div>
            <div class="bulk-group-info">‚Üí –î–µ–¥–ª–∞–π–Ω: ${deadline}</div>
            <div class="bulk-group-info">‚Üí –ó–∞–¥–∞—á: ${tasksCount}</div>
          </div>
        `;
      });

      previewHTML += `
        <div class="bulk-total">
          –í—Å–µ–≥–æ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ: ${totalTasks} –∑–∞–¥–∞—á
        </div>
      `;

      document.getElementById('bulkPreviewContent').innerHTML = previewHTML;

      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
      bulkData = {
        links: links,
        groups: groups,
        contentType: bulkSelectedType,
        platforms: platforms,
        time: bulkSelectedTime
      };

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
      bulkModal.classList.remove('show');
      bulkPreviewModal.classList.add('show');
    });

    // –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ –¥–µ–¥–ª–∞–π–Ω–∞
    function calculateDeadline(hoursOffset, time) {
      const now = new Date();
      const moscowOffset = 3 * 60;
      const localOffset = now.getTimezoneOffset();
      const totalOffset = moscowOffset + localOffset;
      const moscowNow = new Date(now.getTime() + totalOffset * 60 * 1000);

      // –î–æ–±–∞–≤–ª—è–µ–º —Å–º–µ—â–µ–Ω–∏–µ –≤ —á–∞—Å–∞—Ö
      const deadline = new Date(moscowNow.getTime() + hoursOffset * 60 * 60 * 1000);

      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è
      const [hours, minutes] = time.split(':');
      deadline.setHours(parseInt(hours), parseInt(minutes), 0, 0);

      const day = String(deadline.getDate()).padStart(2, '0');
      const month = String(deadline.getMonth() + 1).padStart(2, '0');
      const year = deadline.getFullYear();

      return `${time} ${day}.${month}.${year}`;
    }

    // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è ISO —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –¥–µ–¥–ª–∞–π–Ω–∞
    function createDeadlineISO(hoursOffset, time) {
      const now = new Date();
      const moscowOffset = 3 * 60;
      const localOffset = now.getTimezoneOffset();
      const totalOffset = moscowOffset + localOffset;
      const moscowNow = new Date(now.getTime() + totalOffset * 60 * 1000);

      const deadline = new Date(moscowNow.getTime() + hoursOffset * 60 * 60 * 1000);

      const [hours, minutes] = time.split(':');
      deadline.setHours(parseInt(hours), parseInt(minutes), 0, 0);

      // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç–µ datetime-local
      const year = deadline.getFullYear();
      const month = String(deadline.getMonth() + 1).padStart(2, '0');
      const day = String(deadline.getDate()).padStart(2, '0');
      const h = String(deadline.getHours()).padStart(2, '0');
      const m = String(deadline.getMinutes()).padStart(2, '0');

      return `${year}-${month}-${day}T${h}:${m}`;
    }

    // –í–æ–∑–≤—Ä–∞—Ç –∫ —Ñ–æ—Ä–º–µ –∏–º–ø–æ—Ä—Ç–∞
    bulkPreviewCancelBtn.addEventListener('click', () => {
      bulkPreviewModal.classList.remove('show');
      bulkModal.classList.add('show');
    });

    bulkPreviewModal.addEventListener('click', (e) => {
      if (e.target === bulkPreviewModal) {
        bulkPreviewModal.classList.remove('show');
      }
    });

    // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –º–∞—Å—Å–æ–≤–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞
    bulkConfirmBtn.addEventListener('click', async () => {
      bulkPreviewModal.classList.remove('show');

      try {
        // –§–æ—Ä–º–∏—Ä—É–µ–º –≤—Å–µ –∑–∞–¥–∞—á–∏
        const allTasks = [];

        bulkData.groups.forEach((group, index) => {
          const hoursOffset = (index + 1) * 24;
          const deadlineISO = createDeadlineISO(hoursOffset, bulkData.time);

          group.forEach(link => {
            bulkData.platforms.forEach(platform => {
              allTasks.push({
                materialLink: link,
                contentType: bulkData.contentType,
                platform: platform,
                deadline: deadlineISO
              });
            });
          });
        });

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Google Sheets
        const response = await fetch(SCRIPT_URL, {
          method: 'POST',
          mode: 'no-cors',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ tasks: allTasks })
        });

        // –ü–æ–∫–∞–∑–∞—Ç—å —É—Å–ø–µ—à–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        successMessage.textContent = `‚úÖ –ú–∞—Å—Å–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω! ${allTasks.length} –∑–∞–¥–∞—á –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Google –¢–∞–±–ª–∏—Ü—É!`;
        successMessage.classList.add('show');

        // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã –º–∞—Å—Å–æ–≤–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞
        document.getElementById('bulkLinks').value = '';
        bulkSelectedType = null;
        bulkSelectedPlatforms.clear();
        bulkSelectedTime = null;
        bulkTypeButtons.forEach(btn => btn.classList.remove('active'));
        timeButtons.forEach(btn => btn.classList.remove('active'));
        bulkPlatformsGroup.style.display = 'none';

        setTimeout(() => {
          successMessage.classList.remove('show');
        }, 5000);

      } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
        errorMessage.classList.add('show');

        setTimeout(() => {
          errorMessage.classList.remove('show');
        }, 5000);
      }
    });
  </script>
</body>
</html>
